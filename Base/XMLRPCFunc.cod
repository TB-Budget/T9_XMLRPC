class inherited HTTPCall "";

inclass
  func CreateEx(aURL:string; aMethod:string; MultiRes:Logical=True):XMLRPCFunc;
  --* INPUTS
  --* URL - адрес сервера XMLRPC
  --* Method - название вызываемого метода
    Result = Create;
    Result.URL = aURL;
    Result.Method = aMethod;
    Result.Parser = ResponseParser;
    Result.Parser.Multi = MultiRes;
  end;

inobject
  var URL: String;
  var Method: String;

  func Вызвать synonym Call(Params:Variant[]): Variant;
    var hdr: Storage;
    var xReq: AutoObject;
    var AsyncCla: Class;
    var id: String;
      hdr = Storage.Create;
      hdr.SetField("Content-Type","text/xml; charset=windows-1251");
      xReq = Client.EncodeRequest(self.Method, Params);
      result = self.DoRequest(self.URL, "POST", xReq.xml, hdr);

      AsyncCla = FindClass('XMLRPC.HTTPAsync');
      if result.InheritsFrom(AsyncCla) then
        AddCRC32(id, URL);
        AddCRC32(id, xReq.xml);
        Result.id  = id;
      end;

  end;


end